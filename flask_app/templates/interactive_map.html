<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-draw/dist/leaflet.draw.css" />
    <title>Training Parameters Form</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            padding: 20px;
            position: relative;

        }


        .outer-container {
            display: flex;
            flex-direction: column;
            gap: 20px; /* Space between form and additional container */
            align-items: center;
        }

        .main-container {
            position: absolute;
            display: flex;
            gap: 20px; /* Space between form and additional container */
            justify-content: flex-start;
        }

        .form-container {
            max-width: 330px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .map-container {
            width: 1000px;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .bottom-container {
            position:absolute;
            display:flex;
            margin: 15px auto 0; /* Top margin to create space between the side-by-side containers and this container */
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            top: 760px;
            width: 1390px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .redis-box{
            width: 100px;
            height: 50px;
            border: 2px solid black;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-right: 10px; /* Space between the boxes */
        }

        .text-box{
            width: 100px;
            height: 50px;
            border: 2px solid black;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-right: 10px; /* Space between the boxes */
        }

        h1 {
            text-align: center;
            color: #333;
        }

        label {
            display: block;
            margin-top: 10px;
            color: #555;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            max-width: 300px; /* Limit the width of input fields */
            padding: 10px;
            margin-top: 5px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }

        .form-group {
            margin-bottom: 5px;
            max-width: 320px;
        }

        .filter-group{ /* timespans and coordinate boundaries */
            margin-bottom: 5px;
            max-width: 160px;
        }

        .form-group-inline {
            display: flex;
            flex-wrap: wrap; /* Ensure wrapping on smaller screens */
            gap: 10px; /* Add spacing between inline elements */
        }

        /* Adjust the width for inline elements */
        .form-group-inline input,
        .form-group-inline .form-group {
            width: calc(70%); /* Ensure they share the same row */
            max-width: 170px; /* Remove previous width restriction */
        }

        button {
            display: block;
            width: 100%;
            padding: 10px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
            max-width: 320px;
        }

        button:hover {
            background-color: #0056b3;
        }

        #map {
            height: 100%;
            flex-grow: 1;
        }

        #redis-status-Box {
            width: 10%;
            height: 200px;
            border: 1px solid #ccc;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-right: 20px; /* Space between the boxes */
            font-size: 24px;
        }

        #status-box {
            width: 90%;
            height: 202px;
            box-sizing: border-box;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            resize: none;
            overflow-y: auto;
            display: flex;
            font-size: 24px;
            margin-right: 10px; /* Space between the boxes */
        }

    </style>
</head>
<body>

<div class="outer-container">
    <div class="main-container">
        <div class="form-container">
            <h1>Submit Training Parameters</h1>
            <form id="trainingForm">

                <div class="form-group-inline">
                <div class="form-group" style="max-width: 103px">
                    <label for="max_num_epochs">Max Epochs:</label>
                    <input type="number" id="max_num_epochs" name="max_num_epochs" value="10">
                </div>

                <div class="form-group" style="max-width: 103px">
                    <label for="num_training_repeats">Repeats:</label>
                    <input type="number" id="num_training_repeats" name="num_training_repeats" value="1">
                </div>

                <div class="form-group" style="max-width: 103px">
                    <label for="batch_size">Batch Size:</label>
                    <input type="number" id="batch_size" name="batch_size" value="64">
                </div>
                </div>

                <div class="form-group">
                    <label for="rx_blacklist">Rx Blacklist (comma-separated):</label>
                    <input type="text" id="rx_blacklist" name="rx_blacklist" value="0">
                </div>

                <div class="form-group">
                    <label for="func_list">Func List (comma-separated):</label>
                    <input type="text" id="func_list" name="func_list" value="MSE,COM">
                </div>

                <div class="form-group">
                    <label for="results_type">Results Type:</label>
                    <select id="results_type" name="results_type" style="min-width: 320px">
                        <option value="default">Default</option>
                        <option value="remove_one">Remove One</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="data_filename">Data Filename:</label>
                    <select id="data_filename" name="data_filename" style="min-width: 320px">
                        <!-- Options will be populated here -->
                    </select>
                </div>

                <div class="form-group-inline">
                    <div class="filter-group">
                        <label for="timespan_start">Timespan Start:</label>
                        <input type="number" id="timespan_start" name="timespan_start" value="1675140329">
                    </div>

                    <div class="filter-group">
                        <label for="timespan_end">Timespan End:</label>
                        <input type="number" id="timespan_end" name="timespan_end" value="1675352459">
                    </div>
                </div>



                <div class="form-group-inline">
                    <div class="filter-group">
                        <label for="coordinates_1">SW (lat,lng):</label>
                        <input type="text" id="coordinates_1" name="coordinates_1" value="37.610424,-122.531204">
                    </div>

                    <div class="filter-group">
                        <label for="coordinates_2">NE (lat,lng):</label>
                        <input type="text" id="coordinates_2" name="coordinates_2" value="37.808156,-122.336884">
                    </div>
                </div>

                <button type="submit">Submit</button>
            </form>
        </div>

        <div class="map-container">
            <div id="map"></div>
        </div>
    </div>

    <div class="bottom-container">
        <div id="redis-status-Box" >Loading...</div>

        <textarea id="status-box" readonly></textarea>
    </div>

</div>


<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-draw/dist/leaflet.draw.js"></script>
<script>
    document.getElementById('trainingForm').addEventListener('submit', function(event) {
        event.preventDefault();

        // Collecting form data
        const formData = {
            max_num_epochs: parseInt(document.getElementById('max_num_epochs').value),
            num_training_repeats: parseInt(document.getElementById('num_training_repeats').value),
            batch_size: parseInt(document.getElementById('batch_size').value),
            rx_blacklist: document.getElementById('rx_blacklist').value.split(',').map(Number),
            func_list: document.getElementById('func_list').value.split(','),
            data_filename: document.getElementById('data_filename').value,
            timespan: [
                parseInt(document.getElementById('timespan_start').value),
                parseInt(document.getElementById('timespan_end').value)
            ],
            results_type: document.getElementById('results_type').value,
            coordinates: [
                document.getElementById('coordinates_1').value.split(',').map(Number),
                document.getElementById('coordinates_2').value.split(',').map(Number)
            ]
        };

        console.log('Form Data:', formData);

        // Sending data as JSON in a POST request
        fetch('http://example.com/submit', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        })
        .then(response => response.json())
        .then(data => {
            console.log('Success:', data);
        })
        .catch((error) => {
            console.error('Error:', error);
        });
    });

</script>
<script>
    function initMap(lat, lon) {
        var map = L.map('map').setView([lat, lon], 5);

        // Add a custom tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        var drawnItems = new L.FeatureGroup();
        map.addLayer(drawnItems);

        var drawControl = new L.Control.Draw({
            draw: {
                polygon: false,
                polyline: false,
                circle: false,
                marker: false,
                circlemarker: false,
                rectangle: {
                    shapeOptions: {
                        color: '#000',
                        weight: 2,
                        opacity: 1,
                        fill: false,
                        clickable: true
                    }
                }
            },
            edit: {
                featureGroup: drawnItems
            }
        });
        map.addControl(drawControl);

        map.on(L.Draw.Event.CREATED, function(event) {
            var layer = event.layer;
            drawnItems.addLayer(layer);
            if (event.layerType === 'rectangle') {
                updateRectangleStatus(layer);
            }
        });


        // not sure why this isn't working..
        map.on('draw:edited', function(event) {
            var layers = event.layers;
            layers.eachLayer(function(layer) {
                    updateRectangleStatus(layer);
            });
        });


        // map.on('draw:editmove', function(event) {
        //     var layers = event.layers;
        //     layers.eachLayer(function(layer) {
        //         if (layer instanceof L.Rectangle) {
        //             updateRectangleStatus(layer);
        //         }
        //     });
        // });
    }

    function updateRectangleStatus(rectangle) {
        var bounds = rectangle.getBounds();
        var northWest = bounds.getNorthWest();
        var northEast = bounds.getNorthEast();
        var southWest = bounds.getSouthWest();
        var southEast = bounds.getSouthEast();
        var center = bounds.getCenter();

        updateStatusBox("Rectangle:");
        updateStatusBox("NorthWest: " + northWest);
        updateStatusBox("NorthEast: " + northEast);
        updateStatusBox("SouthWest: " + southWest);
        updateStatusBox("SouthEast: " + southEast);
        updateStatusBox("Center: " + center);

        updateCoords(southWest,northEast);
    }

    function updateCoords(southWest,northEast) {
        var coords1 = document.getElementById("coordinates_1");
        var coords2 = document.getElementById("coordinates_2");

        coords1.value = `${southWest.lat}, ${southWest.lng}`;
        coords2.value = `${northEast.lat}, ${northEast.lng}`;
    }

    function updateStatusBox(message) {
        var statusBox = document.getElementById('status-box');
        statusBox.value += message + '\n';
        statusBox.scrollTop = statusBox.scrollHeight;
    }

    // Check if geolocation is available
    if ("geolocation" in navigator) {
        navigator.geolocation.getCurrentPosition(
            function(position) {
                // Success callback
                var lat = position.coords.latitude;
                var lon = position.coords.longitude;
                initMap(lat, lon);
            },
            function(error) {
                // Error callback
                console.error("Error Code = " + error.code + " - " + error.message);
                // Default location if user denies geolocation or an error occurs
                initMap(39.88, -98.43); // Default to a central location
            }
        );
    } else {
        // Default location if geolocation is not available
        initMap(39.88, -98.43); // Default to a central location
    }

    // to populate datsets dropdown
    function datasetSelect(url) {
    fetch(url)
        .then(response => response.json())
        .then(data => {
            const select = document.getElementById('data_filename');
            data.forEach(item => {
                const option = document.createElement('option');
                option.value = item;
                option.text = item;
                select.appendChild(option);
            });
        })
        .catch(error => console.error('Error fetching data:', error));
    }

    datasetSelect('/data_files');

</script>

</body>
</html>
